<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chauffeur Inloggen en Registreren</title>
</head>
<body>
  <h1>Chauffeur Inloggen en Registreren</h1>

  <div id="register-form">
    <h2>Registreren</h2>
    <input type="text" id="reg-username" placeholder="Kies een gebruikersnaam" required>
    <input type="password" id="reg-password" placeholder="Kies een wachtwoord" required>
    <button onclick="register()">Registreren</button>
  </div>

  <div id="login-form" style="display:none;">
    <h2>Inloggen</h2>
    <input type="text" id="login-username" placeholder="Gebruikersnaam" required>
    <input type="password" id="login-password" placeholder="Wachtwoord" required>
    <button onclick="login()">Inloggen</button>
  </div>

  <div id="driver-info" style="display:none;">
    <h2>Chauffeur Dashboard</h2>
    <p>Je hebt succesvol ingelogd!</p>
    <button onclick="getLocation()">Haal Locatie Op</button>
    <p id="location"></p>
    <p id="address"></p>
  </div>

  <script>
    const apiKey = '5b3ce3597851110001cf6248b6b83abf85e2482d4cc1b97a5b54c101fe48c007';  // OpenRouteService API key

    let drivers = [];  // Lijst van geregistreerde chauffeurs

    // Functie voor registratie
    function register() {
      const username = document.getElementById('reg-username').value;
      const password = document.getElementById('reg-password').value;

      // Check of de chauffeur al bestaat
      const existingDriver = drivers.find(driver => driver.username === username);
      if (existingDriver) {
        alert('Deze gebruikersnaam is al geregistreerd.');
        return;
      }

      // Voeg chauffeur toe aan de lijst
      drivers.push({ username, password });
      alert('Je bent succesvol geregistreerd!');
      document.getElementById('register-form').style.display = 'none';
      document.getElementById('login-form').style.display = 'block';
    }

    // Functie voor inloggen
    function login() {
      const username = document.getElementById('login-username').value;
      const password = document.getElementById('login-password').value;

      // Zoek chauffeur in de lijst
      const driver = drivers.find(driver => driver.username === username && driver.password === password);

      if (driver) {
        alert('Je bent succesvol ingelogd!');
        document.getElementById('login-form').style.display = 'none';
        document.getElementById('driver-info').style.display = 'block';
      } else {
        alert('Foute gebruikersnaam of wachtwoord.');
      }
    }

    // Functie voor het ophalen van de locatie
    function getLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition, showError);
      } else {
        alert("Geolocatie is niet ondersteund door deze browser.");
      }
    }

    // Functie om de locatie weer te geven
    function showPosition(position) {
      const lat = position.coords.latitude;
      const lon = position.coords.longitude;

      document.getElementById('location').innerHTML = `Coördinaten: Lat: ${lat}, Lon: ${lon}`;

      // Haal adres op van OpenRouteService
      getAddressFromCoordinates(lat, lon).then(address => {
        document.getElementById('address').innerHTML = `Adres: ${address}`;
      });
    }

    // Foutmelding als locatie niet kan worden opgehaald
    function showError(error) {
      switch(error.code) {
        case error.PERMISSION_DENIED:
          alert("Geolocatie is geweigerd door de gebruiker.");
          break;
        case error.POSITION_UNAVAILABLE:
          alert("Locatie-informatie is niet beschikbaar.");
          break;
        case error.TIMEOUT:
          alert("Tijdslimiet voor ophalen van locatie is verlopen.");
          break;
        case error.UNKNOWN_ERROR:
          alert("Er is een onbekende fout opgetreden.");
          break;
      }
    }

    // Functie om coördinaten om te zetten naar een adres
    async function getAddressFromCoordinates(lat, lon) {
      const url = `https://api.openrouteservice.org/geocode/reverse?point.lon=${lon}&point.lat=${lat}&api_key=${apiKey}`;

      try {
        const response = await fetch(url);
        const data = await response.json();

        if (data && data.features && data.features.length > 0) {
          const address = data.features[0].properties.label;
          console.log('Adres:', address);
          return address;
        } else {
          console.error('Geen adres gevonden voor de gegeven coördinaten');
          return 'Adres niet gevonden';
        }
      } catch (error) {
        console.error('Fout bij ophalen van adres:', error);
        return 'Fout bij ophalen van adres';
      }
    }
  </script>
</body>
</html>
